{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\hemko\\\\OneDrive - Otago Polytechnic\\\\01_Courses\\\\10_Studio_03\\\\03_Others\\\\Eco-shop\\\\src\\\\context\\\\UserAuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from \"firebase/auth\";\nimport { auth } from \"../firebase\";\nimport FBDataService from \"../context/FBService\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst userAuthContext = /*#__PURE__*/createContext();\nexport function UserAuthContextProvider({\n  children\n}) {\n  _s();\n  const [user, setUser] = useState(null);\n  const [role, setRole] = useState(\"\");\n  const [loading, setLoading] = useState(true);\n  function logIn(email, password) {\n    return signInWithEmailAndPassword(auth, email, password);\n  }\n  function signUp(email, password) {\n    return createUserWithEmailAndPassword(auth, email, password);\n  }\n  function logOut() {\n    return signOut(auth).then(() => {\n      setRole(null);\n      setUser(null);\n    });\n  }\n  function googleSignIn() {\n    const googleAuthProvider = new GoogleAuthProvider();\n    return signInWithPopup(auth, googleAuthProvider);\n  }\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async currentUser => {\n      if (currentUser) {\n        setUser(currentUser);\n        try {\n          const userDoc = await FBDataService.getData(currentUser.uid);\n          if (userDoc.exists()) {\n            setRole(userDoc.data().role || \"\");\n          } else {\n            console.error(\"User document does not exist\");\n            setRole(null);\n            setUser(null);\n          }\n        } catch (error) {\n          console.error(\"Error fetching user role:\", error);\n          setRole(null);\n          setUser(null);\n        }\n      } else {\n        setRole(null);\n        setUser(null);\n      }\n      setLoading(false);\n    });\n    return () => {\n      unsubscribe();\n    };\n  }, []);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(userAuthContext.Provider, {\n    value: {\n      user,\n      role,\n      logIn,\n      signUp,\n      logOut,\n      googleSignIn\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n}\n_s(UserAuthContextProvider, \"AOL63+hjHwjAgEmAipxJRBlED3Y=\");\n_c = UserAuthContextProvider;\nexport function useUserAuth() {\n  _s2();\n  return useContext(userAuthContext);\n}\n_s2(useUserAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"UserAuthContextProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useState","createUserWithEmailAndPassword","signInWithEmailAndPassword","onAuthStateChanged","signOut","GoogleAuthProvider","signInWithPopup","auth","FBDataService","jsxDEV","_jsxDEV","userAuthContext","UserAuthContextProvider","children","_s","user","setUser","role","setRole","loading","setLoading","logIn","email","password","signUp","logOut","then","googleSignIn","googleAuthProvider","unsubscribe","currentUser","userDoc","getData","uid","exists","data","console","error","fileName","_jsxFileName","lineNumber","columnNumber","Provider","value","_c","useUserAuth","_s2","$RefreshReg$"],"sources":["C:/Users/hemko/OneDrive - Otago Polytechnic/01_Courses/10_Studio_03/03_Others/Eco-shop/src/context/UserAuthContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from \"react\";\r\nimport {\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  onAuthStateChanged,\r\n  signOut,\r\n  GoogleAuthProvider,\r\n  signInWithPopup,\r\n} from \"firebase/auth\";\r\nimport { auth } from \"../firebase\";\r\nimport FBDataService from \"../context/FBService\";\r\n\r\nconst userAuthContext = createContext();\r\n\r\nexport function UserAuthContextProvider({ children }) {\r\n  const [user, setUser] = useState(null);\r\n  const [role, setRole] = useState(\"\"); \r\n  const [loading, setLoading] = useState(true);\r\n\r\n  function logIn(email, password) {\r\n    return signInWithEmailAndPassword(auth, email, password);\r\n  }\r\n\r\n  function signUp(email, password) {\r\n    return createUserWithEmailAndPassword(auth, email, password);\r\n  }\r\n\r\n  function logOut() {\r\n    return signOut(auth).then(() => {\r\n      setRole(null);\r\n      setUser(null);\r\n    });\r\n  }\r\n\r\n  function googleSignIn() {\r\n    const googleAuthProvider = new GoogleAuthProvider();\r\n    return signInWithPopup(auth, googleAuthProvider);\r\n  }\r\n\r\n  useEffect(() => {\r\n    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n      if (currentUser) {\r\n        setUser(currentUser);\r\n\r\n        try {\r\n          const userDoc = await FBDataService.getData(currentUser.uid);\r\n          if (userDoc.exists()) {\r\n            setRole(userDoc.data().role || \"\");\r\n          } else {\r\n            console.error(\"User document does not exist\");\r\n            setRole(null);\r\n            setUser(null);\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Error fetching user role:\", error);\r\n          setRole(null);\r\n          setUser(null);\r\n        }\r\n      } else {\r\n        setRole(null);\r\n        setUser(null);\r\n      }\r\n      setLoading(false);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return <div>Loading...</div>;\r\n  }\r\n\r\n  return (\r\n    <userAuthContext.Provider value={{ user, role, logIn, signUp, logOut, googleSignIn }}>\r\n      {children}\r\n    </userAuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useUserAuth() {\r\n  return useContext(userAuthContext);\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}